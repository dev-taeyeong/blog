---
layout: post
title: '[Project] weareneverthat - 2. 데이터베이스 모델링'
categories: Wecode
author: taeyeong

date: 2021-12-30T01:28:06+0900
---
* content
{:toc}
실제로 서비스 되고 있는 웹사이트를 클론 코딩 해보니 그 전에는 생각하지 못했던 문제들이 많이 발생했다. 오늘 하룻동안 데이터베이스를 모델링 하며 발생한 문제들에 대해 정리해보려고 한다.


---

# 모델링 1

![2021-12-30_01-50-26](https://user-images.githubusercontent.com/87692499/147685359-5093c49f-01d0-4f51-88dc-bfe2e73b8dde.png)

드디어 팀과 협업하는 프로젝트가 시작되었다는 기대감에 많은 생각을 하지 않고 만든 데이터베이스 모델링이다. products 라는 테이블과 users 라는 테이블 두 개를 먼저 만들어 놓고 눈에 보이는 정보들을 대충 다 넣은 뒤 다른 테이블들을 하나씩 생성하면서 연결해줬더니 이렇게 잘못된 모델링을 하게 되었다.

모델링 리뷰를 통해 알게된 문제점

1. product 테이블을 위주로 주변 테이블들을 만들다 보니 product_codes라는 이름의 테이블을 만들게 되었는데 다른사람들이 보기에 저게 무엇을 나타내는 테이블인지 알아차리기가 너무 어렵고 우리팀이 설명하는 것도 쉽지가 않았다.
2. product_codes는 한 상품을 나타내고 products는 한 상품의 색상까지 구별해서 들어가는 테이블이다. 그런데 색상이 달라도 제품 이름, 가격, 할인율, 설명, 제조국 등은 모두 같은 값을 가지고 있다. 그래서 그런 중복되는 컬럼들은 product_codes 테이블로 빼는 것이 데이터의 양을 훠어어얼씬 줄일 수 있기때문에 좋다.
3. products 테이블과 users 테이블의 중간테이블로 products_users 라는 테이블을 만들어 장바구니 기능을 구현하려고 했는데 옷과 색상이 정해지더라도 사이즈까지 구분해서 장바구니에 담아야하기 때문에 products_products_sizes 테이블과 users 테이블의 중간 테이블로 장바구니 기능을 구현해야 원하는대로 작동할 것이다.

<br>

# 모델링 2

<img width="1139" alt="2021-12-30_02-55-17" src="https://user-images.githubusercontent.com/87692499/147690285-212f2912-b6bf-4171-b7e9-916f2475fb27.png">

발견한 문제점들을 바탕으로 두 번째 모델을 만들었다. 그런데 장바구니 API를 만드는 팀원이 어떤 방식으로 가져와야 할지 고민하는 것을 보고 다른 팀원들과 같이 생각해봤는데 '원하는 데이터들을 모두 가지고 올 수 있을 것 같지만 과정이 너무 헷갈리는 것 같다'라고 생각이 들어 모델을 조금 수정하기로 했다.

<br>

# 모델링 3

![2021-12-30_02-25-06](https://user-images.githubusercontent.com/87692499/147687962-893224a0-7cb4-4d13-a903-a288c4a9d4b4.png)

products_product_sizes 테이블을 없애고 기본적인 정보 외에 색상, 사이즈, 재고 정보를 함께 가지고 있는 product_details 테이블을 만들었다. product_details 테이블과 users 테이블의 중간에 장바구니 기능을 할 cart 테이블을 만들어 주었다.

여기까지 하고 팀원들끼리 '와 전보다 훨씬 깔끔해진 것 같다, 기능 구현하기도 편하겠다' 라며 기분좋은 마음으로 코딩을 시작했다. 하지만 완벽하게 모델링 했다는 생각은 얼마못가 바뀌게 되었다..

데이터베이스에 데이터를 넣는 작업중 문제를 발견했는데, product_details 테이블이 색상과 사이즈 정보를 모두 가지고 있고 그 상태로 product_images 테이블과 일대다 관계로 연결되어 있다는게 문제였다.

같은 옷, 다른 색상일 경우 다른 이미지를 가지고 있는게 맞지만 같은 옷, 같은 색상, 다른 사이즈의 경우에는 같은 이미지를 가지고 있는게 맞는데, 이 모델은 그렇지가 않다.

<br>

# 모델링 4

<img width="1079" alt="2021-12-30_03-32-08" src="https://user-images.githubusercontent.com/87692499/147692820-25fd0b48-34c5-4d4d-9228-7561c2309a8d.png">

지금 이 글을 작성하고 있는 시간 기준 마지막 모델이다. 앞선 문제들을 모두 해결했고, 테이블 명이나 컬럼 명을 조금 더 이해하기 쉽게 바꿨다. 일단은 팀원 모두 이 모델을 가지고 코드를 짜고 있다.

<br>

# 회고

데이터베이스 모델의 문제를 발견하고 해결하며 정말 많은 것을 느꼈다. 데이터베이스 모델이 복잡하다고 다른 모델로 바꾸면서, 정작 중요한 테이블 간의 관계가 이상하게 꼬여버린 것을 알지 못했던 것은 큰 실수였다. 그리고 여기에 모두 적지는 않았지만 더 많이 모델링을 수정했는데 왜 처음에 충분히 생각하고 모델링을 시작하라고 하는지 몸소 느끼게 된 계기가 되었다.